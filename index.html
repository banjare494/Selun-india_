<!DOCTYPE html>
<html lang="hi" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Salon India â€¢ Register â€¢ List â€¢ Book</title>

  <!-- SEO basic -->
  <meta name="title" content="Salon India - Register â€¢ List â€¢ Book Salon">
  <meta name="description" content="Salon India: register salon, price list set karein, WhatsApp se booking lein. Free, fast & simple.">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://banjare494.github.io/Selun-india_/">
  <meta property="og:title" content="Salon India â€“ Free Salon Register & Booking Platform">
  <meta property="og:description" content="Apna salon register karo, list banao, booking lo â€“ maps & dashboard ke saath!">
  <meta property="og:image" content="https://banjare494.github.io/Selun-india_/images/banner.jpg">
  <meta property="og:url" content="https://banjare494.github.io/Selun-india_/">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="theme-color" content="#0078ff">

  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json">

  <style>
    :root{
      --bg:#0f172a;--bg-soft:#111827;--card:#0b1020;--text:#e5e7eb;--muted:#9ca3af;
      --brand:#3b82f6;--brand-2:#8b5cf6;--ok:#22c55e;--warn:#f59e0b;--err:#ef4444;
      --ring:0 0 0 6px rgba(59,130,246,.15);--shadow:0 12px 30px rgba(0,0,0,.35);
      --radius:18px;--radius-lg:28px;
    }
    [data-theme="light"]{--bg:#f6f9fc;--bg-soft:#eef2f7;--card:#fff;--text:#111827;--muted:#667085;--shadow:0 14px 36px rgba(2,10,40,.10)}
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
    a{color:inherit;text-decoration:none} img{display:block;max-width:100%}
    .wrap{max-width:1080px;margin:0 auto;padding:18px}

    header{position:sticky;top:0;z-index:50;backdrop-filter:saturate(1.3) blur(10px);
      background:linear-gradient(180deg, rgba(15,23,42,.75), rgba(15,23,42,.55));
      border-bottom:1px solid rgba(255,255,255,.06)}
    [data-theme="light"] header{background:rgba(255,255,255,.78);border-bottom:1px solid #e5e7eb}
    .nav{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:12px 18px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.2px}
    .brand .logo{width:36px;height:36px;border-radius:12px;background:linear-gradient(135deg,var(--brand),var(--brand-2));box-shadow:0 8px 20px rgba(59,130,246,.35);display:grid;place-items:center;color:#fff}
    .brand span{font-size:20px}
    .navlinks{display:flex;gap:12px;align-items:center}
    .btn{background:linear-gradient(135deg,var(--brand),var(--brand-2));color:#fff;border:0;border-radius:14px;padding:12px 16px;font-weight:800;cursor:pointer;box-shadow:var(--shadow);transition:transform .06s ease}
    .btn:active{transform:translateY(1px)}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,.14)}
    [data-theme="light"] .btn.ghost{border-color:#e5e7eb}
    .btn.small{padding:8px 10px;font-weight:700;border-radius:10px}

    .hero{position:relative;isolation:isolate}
    .hero .bg{height:300px;border-radius:0 0 var(--radius-lg) var(--radius-lg);
      background:radial-gradient(80% 60% at 10% 10%, rgba(59,130,246,.45), transparent 60%),
                 radial-gradient(60% 50% at 90% 20%, rgba(139,92,246,.40), transparent 60%),
                 linear-gradient(180deg,#020617,#0b1020);overflow:hidden}
    [data-theme="light"] .hero .bg{background:linear-gradient(180deg,#fff,#eef2ff)}
    .hero img.banner{width:100%;height:100%;object-fit:cover;opacity:.18;mix-blend:overlay}
    .hero .headline{position:absolute;inset:0;display:grid;place-items:center;padding:0 16px;text-align:center}
    .hero h1{font-size:clamp(26px,4vw,44px);line-height:1.1}
    .hero p{color:var(--muted);margin-top:10px}

    .grid{display:grid;gap:16px}
    @media(min-width:860px){.grid{grid-template-columns:1.1fr .9fr}}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow)}
    [data-theme="light"] .card{border:1px solid #e5e7eb}
    .h2{font-size:18px;font-weight:900;margin-bottom:10px}
    .muted{color:var(--muted)}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    input,select,textarea{width:100%;padding:12px 14px;border:1px solid rgba(255,255,255,.14);border-radius:12px;background:rgba(255,255,255,.03);color:inherit;outline:none}
    input::placeholder,textarea::placeholder{color:var(--muted)}
    input:focus,select:focus,textarea:focus{box-shadow:var(--ring);border-color:transparent}
    [data-theme="light"] input,[data-theme="light"] select,[data-theme="light"] textarea{background:#fff;border:1px solid #e5e7eb}
    .list{display:grid;gap:12px}
    @media(min-width:720px){.list{grid-template-columns:repeat(2,minmax(0,1fr))}}
    .item{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);padding:16px;display:grid;gap:10px;box-shadow:var(--shadow)}
    [data-theme="light"] .item{border:1px solid #e5e7eb}
    .badges{display:flex;gap:6px;flex-wrap:wrap}
    .tag{font-size:12px;background:rgba(59,130,246,.12);color:#dbeafe;border:1px solid rgba(59,130,246,.25);border-radius:999px;padding:4px 8px}
    [data-theme="light"] .tag{color:#1f3bb3;background:#edf2ff;border:1px solid #dbe5ff}
    .thumb{width:86px;height:86px;border-radius:12px;object-fit:cover;border:1px solid rgba(255,255,255,.12)}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .sp{height:16px}
    footer{text-align:center;padding:22px;background:var(--card);border-top:1px solid rgba(255,255,255,.08);margin-top:18px}
    [data-theme="light"] footer{border-top:1px solid #e5e7eb}
    .toast{position:fixed;right:16px;bottom:16px;z-index:100;background:var(--card);border:1px solid rgba(255,255,255,.12);padding:12px 14px;border-radius:14px;box-shadow:var(--shadow);min-width:240px}
    .hide{display:none !important}
    .sr{position:absolute;left:-9999px}
    .star{font-size:22px;cursor:pointer}

    /* Booking calendar */
    .slots{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:8px}
    .slot{border:1px solid rgba(255,255,255,.18);padding:10px;border-radius:10px;text-align:center;cursor:pointer}
    .slot.sel{outline:2px solid var(--brand)}
    .slot.dis{opacity:.45;pointer-events:none}
    [data-theme="light"] .slot{border-color:#e5e7eb}

    /* Detail page */
    #detailPage .header{display:flex;gap:14px;align-items:center}
    #detailPage .prices{display:flex;gap:8px;flex-wrap:wrap}
    #detailPage .back{margin-bottom:10px}
    .mapBox{border-radius:14px;overflow:hidden;border:1px solid rgba(255,255,255,.12)}
    [data-theme="light"] .mapBox{border-color:#e5e7eb}

    /* Admin */
    .kpis{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px}
    @media(max-width:820px){.kpis{grid-template-columns:repeat(2,minmax(0,1fr))}}
    .kpi{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:14px}
    [data-theme="light"] .kpi{border-color:#e5e7eb}
    .kpi .val{font-size:22px;font-weight:900}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px 10px;border-bottom:1px solid rgba(255,255,255,.12);text-align:left}
    [data-theme="light"] th,[data-theme="light"] td{border-color:#e5e7eb}
    th{font-weight:800}
  </style>
</head>
<body>
  <header>
    <div class="nav wrap">
      <a class="brand" href="#home" aria-label="Salon India Home">
        <div class="logo">ğŸ’ˆ</div><span>Salon India</span>
      </a>
      <nav class="navlinks">
        <a href="#admin" class="btn ghost" title="Dashboard">ğŸ“Š</a>
        <button id="loginBtn" class="btn ghost" title="Owner Login">ğŸ”</button>
        <button id="themeBtn" class="btn ghost" title="Dark / Light">ğŸŒ—</button>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section id="home" class="hero">
    <div class="bg">
      <img class="banner" src="https://images.unsplash.com/photo-1512690459411-b9245aed614b?q=80&w=1600&auto=format&fit=crop" alt="Salon banner">
    </div>
    <div class="headline wrap">
      <div>
        <h1>Register â€¢ List â€¢ Book â€” Premium, fast & free</h1>
        <p>Owners apna page register karein, prices set karein, aur customers WhatsApp se instant booking karein.</p>
      </div>
    </div>
  </section>

  <!-- ABOUT -->
  <section id="about" class="wrap" style="margin-top:18px">
    <div class="grid">
      <div class="card">
        <div class="h2">Bharat ke salon owners ke liye smart platform</div>
        <p class="muted">Koi complicated app nahi. Sirf form bhariye aur turant listing ready.</p>
        <div class="sp"></div>
        <ul class="muted" style="display:grid;gap:6px;list-style:none">
          <li>âœ… Short link, prices, ratings, photo, WhatsApp</li>
          <li>âœ… Live City/Area filter, Owner login</li>
          <li>âœ… Detail Page + Booking Calendar + ğŸ“ Maps</li>
          <li>âœ… Offline PWA + Install App</li>
          <li>ğŸ†• ğŸ“Š Admin Dashboard</li>
        </ul>
        <div class="sp"></div>
        <div class="row">
          <a class="btn" href="#register">+ Register</a>
          <a class="btn ghost" href="#list">ğŸ” Browse</a>
        </div>
      </div>
    </div>
  </section>

  <!-- REGISTER -->
  <section id="register" class="wrap" style="margin-top:18px">
    <div class="h2">ğŸ“ Owner Register</div>
    <div class="card">
      <div class="row">
        <input id="owner"  placeholder="Owner Name" autocomplete="name">
        <input id="mobile" placeholder="Mobile (10-digit ya 91XXXXXXXXXX)" inputmode="numeric" maxlength="12" autocomplete="tel">
        <input id="salonName" type="text" placeholder="Salon Name" required>

        <input id="slug" type="text" placeholder="Short Link (slug) â€” e.g., kamlesh-salon" inputmode="latin" pattern="[a-z0-9\-]{3,}" title="sirf a-z, 0-9 aur hyphen (-)" required>
        <small id="slugHelp" style="display:block;margin-top:6px;color:var(--muted);font-size:12px;">Short link auto ban raha hai. Aap chahe to edit kar sakte hain. Sirf a-z, 0-9, â€œ-â€.</small>

        <input id="city" placeholder="City / Area" autocomplete="address-level2">

        <!-- PHOTO UPLOAD -->
        <label class="btn ghost" for="photo" style="display:inline-grid;place-items:center;cursor:pointer">ğŸ“· Upload salon photo</label>
        <input id="photo" class="sr" type="file" accept="image/*">
        <img id="photoPrev" class="thumb hide" alt="Preview">

        <!-- ADDRESS + MAP -->
        <input id="addr" placeholder="Address (optional)">
        <div class="row">
          <input id="lat" placeholder="Latitude (e.g., 21.2513)" inputmode="decimal">
          <input id="lng" placeholder="Longitude (e.g., 81.6296)" inputmode="decimal">
          <button id="gpsBtn" type="button" class="btn ghost">ğŸ“ Use GPS</button>
        </div>

        <!-- OWNER PIN -->
        <input id="pin" placeholder="Set Owner PIN (4â€“6 digits)" inputmode="numeric" maxlength="6">
      </div>

      <div class="sp"></div>
      <div class="muted" style="margin-bottom:8px">Services & Prices (â‚¹)</div>
      <div class="row">
        <input id="pHaircut" type="number" placeholder="Haircut (â‚¹)" value="120" min="0">
        <input id="pShave"   type="number" placeholder="Shave (â‚¹)"   value="60" min="0">
        <input id="pBeard"   type="number" placeholder="Beard (â‚¹)"   value="80" min="0">
        <input id="pFacial"  type="number" placeholder="Facial (â‚¹)"  value="300" min="0">
      </div>
      <div class="sp"></div>
      <input id="wa" placeholder="WhatsApp Number (e.g., 91XXXXXXXXXX)">
      <div class="sp"></div>
      <button id="btnCreate" class="btn full">Create Account</button>
      <div id="msg" class="muted" style="margin-top:10px"></div>
    </div>
  </section>

  <!-- LIST -->
  <section id="list" class="wrap" style="margin-top:18px">
    <div class="h2">ğŸ” Salon List</div>
    <div class="card">
      <div class="toolbar">
        <input id="qCity" placeholder="City / Area (live filter)">
        <select id="qService">
          <option value="">Any service</option>
          <option value="haircut">Haircut</option>
          <option value="shave">Shave</option>
          <option value="beard">Beard</option>
          <option value="facial">Facial</option>
        </select>
        <select id="qSort">
          <option value="name">Sort: Name</option>
          <option value="priceAsc">Price (lowâ†’high)</option>
          <option value="priceDesc">Price (highâ†’low)</option>
          <option value="new">Newest</option>
          <option value="rating">Top Rated</option>
        </select>
        <input id="qText" placeholder="Search name/owner">
        <button id="btnSearch" class="btn">Search</button>
      </div>
    </div>
    <div class="sp"></div>
    <div id="listOut" class="list"></div>
  </section>

  <!-- DETAIL PAGE -->
  <section id="detailPage" class="wrap hide" style="margin-top:18px">
    <button class="btn ghost back" id="backBtn">â† Back</button>
    <div class="card" id="detailCard"></div>
  </section>

  <!-- ADMIN DASHBOARD -->
  <section id="adminPage" class="wrap hide" style="margin-top:18px">
    <div class="h2">ğŸ“Š Admin Dashboard</div>
    <div class="kpis" id="kpiRow"></div>
    <div class="sp"></div>

    <div class="grid">
      <div class="card">
        <div class="row" style="justify-content:space-between">
          <div class="h2">ğŸ•˜ Recent Bookings</div>
          <div class="row">
            <button id="exportCsv" class="btn small">â¬‡ï¸ Export CSV</button>
            <button id="clearBookings" class="btn ghost small">ğŸ—‘ï¸ Clear Bookings</button>
          </div>
        </div>
        <div class="sp"></div>
        <div style="overflow:auto">
          <table id="bkTable">
            <thead>
              <tr><th>Date</th><th>Time</th><th>Salon</th><th>Service</th><th>Customer</th><th>Notes</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <div class="h2">ğŸ™ï¸ Top Cities</div>
        <table id="cityTable"><thead><tr><th>City</th><th>Salons</th></tr></thead><tbody></tbody></table>
      </div>

      <div class="card">
        <div class="h2">â­ Top Rated Salons</div>
        <table id="topRated"><thead><tr><th>Salon</th><th>Avg â˜…</th><th>Ratings</th></tr></thead><tbody></tbody></table>
      </div>

      <div class="card">
        <div class="h2">ğŸ”¥ Most Booked Salons</div>
        <table id="topBooked"><thead><tr><th>Salon</th><th>Bookings</th></tr></thead><tbody></tbody></table>
      </div>
    </div>
  </section>

  <footer>Made with â¤ï¸ by Kamlesh Banjare â€¢ Free hosting on GitHub Pages</footer>

  <!-- LOGIN -->
  <dialog id="loginDialog" aria-labelledby="loginTitle">
    <div class="modal-head">
      <div id="loginTitle" style="font-weight:900">Owner Login</div>
      <button class="x" id="closeLogin">âœ–</button>
    </div>
    <div class="modal-body" style="display:grid;gap:12px">
      <input id="loginMobile" placeholder="Registered Mobile (10 or 91+10)" inputmode="numeric" maxlength="12">
      <input id="loginPin" placeholder="PIN (4â€“6 digits)" inputmode="numeric" maxlength="6">
      <button id="doLogin" class="btn">Login</button>
      <div id="loginMsg" class="muted"></div>
    </div>
  </dialog>

  <script>
    /* ===== Storage ===== */
    const LS="salon-india:v5";
    const SESS="salon-india:session";
    const LSB="salon-india:bookings";
    const load = ()=>JSON.parse(localStorage.getItem(LS)||"[]");
    const save = (a)=>localStorage.setItem(LS, JSON.stringify(a));
    const setSession = (obj)=>localStorage.setItem(SESS, JSON.stringify(obj||{}));
    const getSession = ()=>JSON.parse(localStorage.getItem(SESS)||"{}");
    const loadBk = ()=>JSON.parse(localStorage.getItem(LSB)||"{}");
    const saveBk = (o)=>localStorage.setItem(LSB, JSON.stringify(o));

    /* ===== Helpers ===== */
    const $ = s => document.querySelector(s);
    const toast=(msg)=>{const t=document.createElement('div');t.className='toast';t.textContent=msg;document.body.appendChild(t);setTimeout(()=>t.remove(),3000);};
    const show = el => el.classList.remove('hide');
    const hide = el => el.classList.add('hide');
    const numOrNull = v => { const n=parseFloat(v); return Number.isFinite(n)?n:null; };

    // theme: set ASAP (1 place only)
    (function(){const pref=localStorage.getItem('theme'); if(pref) document.documentElement.setAttribute('data-theme',pref);})();
    $('#themeBtn')?.addEventListener('click',()=>{
      const cur=document.documentElement.getAttribute('data-theme');
      const next=cur==='light'?'dark':'light';
      document.documentElement.setAttribute('data-theme',next);
      localStorage.setItem('theme',next);
    });

    // slug helpers
    function makeSlug(str){ return (str||"").toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'').replace(/-{2,}/g,'-').slice(0,50); }
    function slugExists(s){ try{ return load().some(x => (x.slug||"").toLowerCase()===(s||"").toLowerCase()); }catch(e){ return false; } }
    const salonName=$('#salonName'), slugInput=$('#slug'), slugHelp=$('#slugHelp'); let slugManuallyEdited=false;
    if(salonName&&slugInput){
      salonName.addEventListener('input',()=>{ if(!slugManuallyEdited){ slugInput.value=makeSlug(salonName.value); validateSlug(); }});
      slugInput.addEventListener('input',()=>{ slugManuallyEdited=true; slugInput.value=makeSlug(slugInput.value); validateSlug(); });
    }
    function validateSlug(){
      const s=slugInput.value; const bad=!/^[a-z0-9-]{3,}$/.test(s); const taken=slugExists(s);
      if(bad){ slugInput.style.borderColor='var(--err)'; slugHelp.textContent='Slug me sirf a-z, 0-9 aur â€œ-â€ (min 3 chars).'; slugHelp.style.color='var(--err)'; }
      else if(taken){ slugInput.style.borderColor='var(--warn)'; slugHelp.textContent='Ye short link already use me hai. Koi aur try karein.'; slugHelp.style.color='var(--warn)'; }
      else { slugInput.style.borderColor='var(--ok)'; slugHelp.textContent='Perfect! Ye short link available hai.'; slugHelp.style.color='var(--ok)'; }
    }

    /* ===== Photo preview ===== */
    const fileEl = $('#photo'), prevEl = $('#photoPrev');
    let photoDataURL = "";
    fileEl?.addEventListener('change', (e)=>{
      const f=e.target.files?.[0]; if(!f) return;
      const r=new FileReader();
      r.onload=()=>{ photoDataURL=r.result||""; prevEl.src=photoDataURL; prevEl.classList.remove('hide'); };
      r.readAsDataURL(f);
    });

    /* ===== GPS button ===== */
    $('#gpsBtn')?.addEventListener('click', ()=>{
      if(!navigator.geolocation){ toast('GPS supported nahi hai'); return; }
      navigator.geolocation.getCurrentPosition(
        pos=>{ $('#lat').value=pos.coords.latitude.toFixed(6); $('#lng').value=pos.coords.longitude.toFixed(6); toast('Location set âœ…'); },
        err=>{ toast('GPS error: '+err.message); },
        {enableHighAccuracy:true, timeout:12000}
      );
    });

    /* ===== Register ===== */
    const showMsg=(t,type)=>{ const el=$("#msg"); el.textContent=t; el.style.color= type==="ok"?"var(--ok)":"var(--warn)"; toast(t); };

    $('#btnCreate').addEventListener('click', ()=>{
      const salon={
        id:Date.now(),
        owner: $('#owner').value.trim(),
        mobile: $('#mobile').value.trim(),
        name: $('#salonName').value.trim(),
        city: ($('#city').value.trim()||"").toLowerCase(),
        slug: ($('#slug').value.trim()||"").toLowerCase(),
        price: {
          haircut: +($('#pHaircut').value||0),
          shave:   +($('#pShave').value||0),
          beard:   +($('#pBeard').value||0),
          facial:  +($('#pFacial').value||0)
        },
        wa: $('#wa').value.trim(),
        pin: ($('#pin').value||"").trim(),
        photo: photoDataURL||"",
        rSum: 0, rCount: 0,
        loc: {
          address: ($('#addr').value||'').trim(),
          lat: numOrNull($('#lat').value),
          lng: numOrNull($('#lng').value)
        }
      };

      const is10=/^\d{10}$/.test(salon.mobile);
      const is91=/^91\d{10}$/.test(salon.mobile);
      if(!salon.owner || !(is10||is91) || !salon.name || !salon.city){
        showMsg("âš ï¸ Owner, 10-digit mobile (ya 91+10), Salon name aur City zaroori hain.","warn"); return;
      }
      salon.mobile = salon.mobile.slice(-10);
      if(!salon.pin || !/^\d{4,6}$/.test(salon.pin)){ showMsg("âš ï¸ PIN 4â€“6 digit ka set karein.","warn"); return; }

      if(!salon.slug) salon.slug=makeSlug(salon.name);
      if(!/^[a-z0-9-]{3,}$/.test(salon.slug)){ showMsg("âš ï¸ Slug galat hai.","warn"); return; }
      if(slugExists(salon.slug)){ showMsg("âš ï¸ Ye short link (slug) pehle se use me hai.","warn"); return; }

      const all=load(); all.push(salon); save(all);
      showMsg("âœ… Salon add ho gaya! (Salon List me dekh sakte ho)","ok");
      ['owner','mobile','salonName','city','slug','wa','pin','pHaircut','pShave','pBeard','pFacial','addr','lat','lng'].forEach(id=>{const el=document.getElementById(id); if(el) el.value='';});
      photoDataURL=""; prevEl.classList.add('hide'); prevEl.src="";
      slugManuallyEdited=false; renderList();
    });

    /* ===== List / Search / Sort ===== */
    const outEl = $('#listOut');
    const minPrice = s => { const v=Object.values(s.price||{}).filter(n=>typeof n==='number'&&n>0); return v.length?Math.min(...v):0; };
    const avgRating = s => s.rCount? (s.rSum/s.rCount) : 0;

    function renderItem(s){
      const el=document.createElement('div'); el.className='item';
      const waBase=s.wa?`https://wa.me/${s.wa}`:'';
      const isOwner=(getSession().id===s.id);

      el.innerHTML = `
        <div style="display:flex;gap:12px;align-items:center">
          ${s.photo?`<img class="thumb" src="${s.photo}" alt="${s.name}">`:''}
          <div style="flex:1">
            <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
              <div>
                <div style="font-weight:900;font-size:18px">ğŸ’ˆ ${s.name}</div>
                <div class="muted">Owner: ${s.owner} â€¢ City: ${s.city} â€¢ â­ ${avgRating(s).toFixed(1)} (${s.rCount})</div>
              </div>
              <div class="row">
                <button class="btn" data-open="${s.slug||s.id}">View / Book</button>
                ${waBase?`<a class="btn ghost" target="_blank" href="${waBase}?text=${encodeURIComponent('Namaste '+s.name+' me booking karna hai.')}" title="WhatsApp">WhatsApp</a>`:''}
              </div>
            </div>
          </div>
        </div>
        <div class="badges">
          <span class="tag">âœ‚ï¸ Haircut â‚¹${s.price?.haircut||'-'}</span>
          <span class="tag">ğŸª’ Shave â‚¹${s.price?.shave||'-'}</span>
          <span class="tag">ğŸ§” Beard â‚¹${s.price?.beard||'-'}</span>
          <span class="tag">ğŸ’† Facial â‚¹${s.price?.facial||'-'}</span>
          ${s.loc?.lat&&s.loc?.lng?`<span class="tag">ğŸ“ On Map</span>`:''}
          ${isOwner?`<span class="tag">ğŸ› ï¸ Owner Mode</span>`:''}
        </div>
      `;
      el.querySelector('[data-open]')?.addEventListener('click',e=>{
        const slug=e.currentTarget.getAttribute('data-open'); location.hash=`#s/${encodeURIComponent(slug)}`;
      });
      return el;
    }

    function renderList(){
      const qCity=(($('#qCity')?.value)||'').trim().toLowerCase();
      const qSrv=(($('#qService')?.value)||'').trim();
      const qText=(($('#qText')?.value)||'').trim().toLowerCase();
      const qSort=(($('#qSort')?.value)||'name');

      let rows=load().filter(s=>{
        const byCity=qCity ? (s.city||'').includes(qCity) : true;
        const byText=qText ? ((s.name||'').toLowerCase().includes(qText) || (s.owner||'').toLowerCase().includes(qText)) : true;
        const bySrv=qSrv ? ((s.price||{})[qSrv]>0) : true;
        return byCity && byText && bySrv;
      });

      rows.sort((a,b)=>{
        if(qSort==='priceAsc') return minPrice(a)-minPrice(b);
        if(qSort==='priceDesc')return minPrice(b)-minPrice(a);
        if(qSort==='new')     return b.id-a.id;
        if(qSort==='rating')  return avgRating(b)-avgRating(a);
        return (a.name||'').localeCompare(b.name||'');
      });

      outEl.innerHTML='';
      if(!rows.length){ outEl.innerHTML=`<div class="card muted">Koi salon nahi mila. Filters change karein ya pehle Register karein.</div>`; return; }
      rows.forEach(s=>outEl.appendChild(renderItem(s)));
    }
    document.getElementById('btnSearch')?.addEventListener('click',renderList);
    document.getElementById('qCity')?.addEventListener('input',renderList);

    /* ===== Booking calendar utils ===== */
    const workStart=9, workEnd=19, stepMin=30;
    const bookedSetFor = (salonId, dateStr) => new Set((loadBk()[salonId]?.[dateStr]||[]).map(x=>x.time));
    function addBookingRecord(salonId, dateStr, rec){
      const all=loadBk();
      if(!all[salonId]) all[salonId]={};
      if(!all[salonId][dateStr]) all[salonId][dateStr]=[];
      all[salonId][dateStr].push(rec);
      saveBk(all);
    }
    function buildSlotGrid(dateStr, bookedSet){
      const wrap=document.createElement('div'); wrap.className='slots';
      const mk=n=>n.toString().padStart(2,'0');
      let t=new Date(dateStr+'T'+mk(workStart)+':00:00');
      const end=new Date(dateStr+'T'+mk(workEnd)+':00:00');
      while(t<end){
        const hh=mk(t.getHours()), mm=mk(t.getMinutes());
        const key=`${hh}:${mm}`;
        const b=document.createElement('button');
        b.type='button'; b.className='slot'+(bookedSet.has(key)?' dis':''); b.textContent=key;
        b.dataset.time=key;
        wrap.appendChild(b);
        t=new Date(t.getTime()+stepMin*60000);
      }
      return wrap;
    }

    /* ===== Detail PAGE Renderer (with Ratings) ===== */
    const detailWrap = $('#detailPage');
    const detailCard = $('#detailCard');

    const label = k => ({haircut:'Haircut',shave:'Shave',beard:'Beard',facial:'Facial'})[k]||k;
    const avg = s => s.rCount? (s.rSum/s.rCount) : 0;
    const mapIframe = (lat,lng,zoom=15) => {
      const src=`https://www.google.com/maps?q=${lat},${lng}&z=${zoom}&output=embed`;
      return `<div class="mapBox"><iframe width="100%" height="260" style="border:0" loading="lazy" allowfullscreen referrerpolicy="no-referrer-when-downgrade" src="${src}"></iframe></div>`;
    };

    function renderDetailPage(slugOrId){
      const a=load();
      const s=a.find(x=>(x.slug||x.id.toString())===slugOrId);
      if(!s){ detailCard.innerHTML='<div class="card">Salon nahi mila.</div>'; return; }

      hide($('#home')); hide($('#about')); hide($('#register')); hide($('#list')); hide($('#adminPage')); show(detailWrap);

      const waBase=s.wa?`https://wa.me/${s.wa}`:'';
      const shareUrl=`${location.origin}${location.pathname}#s/${encodeURIComponent(s.slug||s.id)}`;
      const hasLoc = Number.isFinite(s.loc?.lat) && Number.isFinite(s.loc?.lng);
      const gLink  = hasLoc ? `https://maps.google.com/?q=${s.loc.lat},${s.loc.lng}` : '';
      const dirLink= hasLoc ? `https://www.google.com/maps/dir/?api=1&destination=${s.loc.lat},${s.loc.lng}` : '';

      detailCard.innerHTML = `
        <div class="header">
          ${s.photo?`<img class="thumb" src="${s.photo}" alt="${s.name}">`:''}
          <div>
            <div class="h2" style="font-size:22px">${s.name}</div>
            <div class="muted">Owner: ${s.owner} â€¢ ${s.city} â€¢ â­ ${avg(s).toFixed(1)} (${s.rCount})</div>
            ${s.loc?.address?`<div class="muted">ğŸ“ ${s.loc.address}</div>`:''}
            <div class="row" style="margin-top:8px">
              ${waBase?`<a class="btn" target="_blank" href="${waBase}?text=${encodeURIComponent('Namaste '+s.name+' me booking karna hai.')}" title="WhatsApp">WhatsApp</a>`:''}
              <button class="btn ghost" id="copyLink">ğŸ”— Copy Link</button>
              ${hasLoc?`<a class="btn ghost" target="_blank" href="${gLink}">ğŸ—ºï¸ Open Map</a>`:''}
            </div>
          </div>
        </div>

        <div class="sp"></div>
        <div class="prices">
          <span class="tag">âœ‚ï¸ Haircut â‚¹${s.price?.haircut||'-'}</span>
          <span class="tag">ğŸª’ Shave â‚¹${s.price?.shave||'-'}</span>
          <span class="tag">ğŸ§” Beard â‚¹${s.price?.beard||'-'}</span>
          <span class="tag">ğŸ’† Facial â‚¹${s.price?.facial||'-'}</span>
        </div>

        ${hasLoc?`<div class="sp"></div><div class="h2">ğŸ“ Location</div>${mapIframe(s.loc.lat,s.loc.lng)}<div class="row" style="margin-top:8px"><a class="btn" target="_blank" href="${dirLink}">ğŸš— Get Directions</a></div>`:''}

        <div class="sp"></div>
        <div class="h2">ğŸ“… Book a time</div>
        <div class="row">
          <select id="svcSel">${Object.entries(s.price).filter(([k,v])=>v>0).map(([k,v])=>`<option value="${k}">${label(k)} â€” â‚¹${v}</option>`).join('')}</select>
          <input id="dateSel" type="date">
        </div>
        <div class="sp"></div>
        <div id="slotsArea"></div>
        <div class="sp"></div>
        <div class="row">
          <input id="bkName" placeholder="Your Name">
          <input id="bkNotes" placeholder="Notes (optional)">
        </div>
        <div class="sp"></div>
        <div class="row">
          <button class="btn" id="confirmBk"${waBase?'':' disabled'}>${waBase?'Send WhatsApp Booking':'WhatsApp not set'}</button>
          <button class="btn ghost" id="copyBk">Copy Booking Text</button>
        </div>

        <div class="sp"></div>
        <div class="h2">â­ Rate this salon</div>
        <div id="rateRow">${[1,2,3,4,5].map(n=>`<span class="star" data-rate="${n}">â˜†</span>`).join('')}</div>
      `;

      document.getElementById('copyLink').addEventListener('click',()=>navigator.clipboard.writeText(shareUrl).then(()=>toast('Link copied')));

      // init date + slots
      const dateEl=document.getElementById('dateSel'); const slotsArea=document.getElementById('slotsArea');
      const d=new Date(); const min=d.toISOString().slice(0,10);
      dateEl.min=min; dateEl.value=min;
      let selectedTime="";

      function drawSlots(){
        selectedTime="";
        const set=bookedSetFor(s.id, dateEl.value);
        slotsArea.innerHTML="";
        const grid=buildSlotGrid(dateEl.value,set);
        slotsArea.appendChild(grid);
        grid.querySelectorAll('.slot').forEach(btn=>{
          btn.addEventListener('click',()=>{
            grid.querySelectorAll('.slot').forEach(b=>b.classList.remove('sel'));
            btn.classList.add('sel'); selectedTime=btn.dataset.time;
          });
        });
      }
      drawSlots();
      dateEl.addEventListener('change',drawSlots);

      const bookingText=()=> {
        const svc=label(document.getElementById('svcSel').value);
        const nm=(document.getElementById('bkName').value||'').trim()||'Customer';
        const notes=(document.getElementById('bkNotes').value||'').trim();
        return `Namaste ${s.name}!\nMain ${nm} ${svc} ke liye ${dateEl.value} ${selectedTime} par booking karna chahta/chahti hu. ${notes?('Notes: '+notes):''}\n\nâ€“ via Salon India`;
      };

      document.getElementById('confirmBk').addEventListener('click',()=>{
        if(!selectedTime){ toast('Time slot select karein'); return; }
        const rec={ time:selectedTime, date:dateEl.value, service:document.getElementById('svcSel').value, name:(document.getElementById('bkName').value||'').trim()||'Customer', notes:(document.getElementById('bkNotes').value||'').trim(), createdAt:Date.now() };
        addBookingRecord(s.id, dateEl.value, rec);
        toast('Booking saved âœ…');
        if(s.wa) window.open(`https://wa.me/${s.wa}?text=${encodeURIComponent(bookingText())}`,'_blank');
        drawSlots();
      });
      document.getElementById('copyBk').addEventListener('click',()=>{
        if(!selectedTime){ toast('Time slot select karein'); return; }
        navigator.clipboard.writeText(bookingText()).then(()=>toast('Booking text copied')).catch(()=>toast('Copied text'));
      });

      // ratings (re-render detail to reflect)
      [...document.querySelectorAll('#rateRow .star')].forEach(st=>{
        st.addEventListener('click',()=>{
          const r=parseInt(st.getAttribute('data-rate'));
          const arr=load(); const i=arr.findIndex(x=>x.id===s.id);
          if(i>-1){ arr[i].rSum += r; arr[i].rCount += 1; save(arr); toast(`Thanks! Rated ${r}â˜…`); renderDetailPage(slugOrId); }
        });
      });
    }

    // Back button
    document.getElementById('backBtn').addEventListener('click',()=>{
      location.hash="#list";
      hide(detailWrap); hide(document.getElementById('adminPage')); show(document.getElementById('home')); show(document.getElementById('about')); show(document.getElementById('register')); show(document.getElementById('list'));
      renderList();
    });

    /* ===== ADMIN DASHBOARD ===== */
    const adminWrap=document.getElementById('adminPage');
    const kpiRow = document.getElementById('kpiRow');

    function flattenBookings(){
      const map=loadBk(); const salons=load();
      const out=[];
      Object.entries(map).forEach(([sid,dates])=>{
        const salon=salons.find(s=>s.id===+sid);
        Object.entries(dates).forEach(([date,arr])=>{
          arr.forEach(rec=>{
            out.push({
              salonId:+sid,
              salon: salon?.name||'Unknown',
              city: salon?.city||'',
              service: rec.service,
              date: rec.date||date,
              time: rec.time,
              name: rec.name||'',
              notes: rec.notes||'',
              createdAt: rec.createdAt||Date.now()
            });
          });
        });
      });
      out.sort((a,b)=>b.createdAt-a.createdAt);
      return out;
    }

    function fillTable(tbody, rows, cols){
      tbody.innerHTML='';
      rows.forEach(r=>{
        const tr=document.createElement('tr');
        cols.forEach(c=>{
          const td=document.createElement('td'); td.textContent=(typeof c==='function'?c(r):r[c])??''; tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    }

    function toCSV(rows){
      const headers=['date','time','salon','city','service','customer','notes'];
      const lines=[headers.join(',')];
      rows.forEach(r=>{
        const vals=[r.date,r.time,r.salon,r.city,r.service,(r.name||''),(r.notes||'')].map(v=>`"${String(v).replace(/"/g,'""')}"`);
        lines.push(vals.join(','));
      });
      return lines.join('\n');
    }

    function renderAdmin(){
      hide(document.getElementById('home')); hide(document.getElementById('about')); hide(document.getElementById('register')); hide(document.getElementById('list')); hide(document.getElementById('detailPage')); show(adminWrap);

      const salons=load();
      const bookings=flattenBookings();

      const withWA=salons.filter(s=>s.wa).length;
      const avgAll = salons.length ? (salons.reduce((a,s)=>a+(s.rCount? s.rSum/s.rCount : 0),0)/salons.length) : 0;

      const now=new Date();
      const todayStr=now.toISOString().slice(0,10);
      const startOfWeek=new Date(now); startOfWeek.setDate(now.getDate()-now.getDay());
      const weekStr=startOfWeek.toISOString().slice(0,10);

      const todayCount=bookings.filter(b=>b.date===todayStr).length;
      const weekCount=bookings.filter(b=>b.date>=weekStr).length;

      kpiRow.innerHTML='';
      [
        {label:'Total Salons', val:salons.length},
        {label:'With WhatsApp', val:withWA},
        {label:'Avg Rating', val:avgAll.toFixed(2)},
        {label:'Total Bookings', val:bookings.length},
        {label:'Today', val:todayCount},
        {label:'This Week', val:weekCount},
      ].forEach(k=>{
        const d=document.createElement('div'); d.className='kpi';
        d.innerHTML=`<div class="muted">${k.label}</div><div class="val">${k.val}</div>`;
        kpiRow.appendChild(d);
      });

      // Recent bookings
      fillTable(document.querySelector('#bkTable tbody'), bookings.slice(0,20), [
        'date','time','salon','service', r=>r.name, r=>r.notes
      ]);

      // Top cities
      const cityMap={};
      salons.forEach(s=>{ if(!s.city) return; cityMap[s.city]=(cityMap[s.city]||0)+1; });
      const cityRows=Object.entries(cityMap).sort((a,b)=>b[1]-a[1]).map(([city,count])=>({city,count}));
      fillTable(document.querySelector('#cityTable tbody'), cityRows, ['city','count']);

      // Top rated
      const rated=salons.filter(s=>s.rCount>0).map(s=>({salon:s.name, avg:(s.rSum/s.rCount), count:s.rCount}));
      rated.sort((a,b)=>b.avg-a.avg);
      fillTable(document.querySelector('#topRated tbody'), rated.slice(0,10), [r=>r.salon, r=>r.avg.toFixed(2), 'count']);

      // Most booked
      const bkCountBySalon={};
      bookings.forEach(b=>{ bkCountBySalon[b.salon]=(bkCountBySalon[b.salon]||0)+1; });
      const topBooked=Object.entries(bkCountBySalon).map(([salon,count])=>({salon,count})).sort((a,b)=>b.count-a.count);
      fillTable(document.querySelector('#topBooked tbody'), topBooked.slice(0,10), ['salon','count']);

      // Buttons
      document.getElementById('exportCsv').onclick=()=>{
        const csv=toCSV(bookings);
        const blob=new Blob([csv],{type:'text/csv'});
        const url=URL.createObjectURL(blob);
        const a=document.createElement('a');
        a.href=url; a.download='salon-bookings.csv'; a.click(); URL.revokeObjectURL(url);
      };
      document.getElementById('clearBookings').onclick=()=>{
        if(confirm('Pakka? Sirf local bookings data clear hoga.')){
          localStorage.setItem(LSB, JSON.stringify({}));
          toast('Bookings cleared'); renderAdmin();
        }
      };
    }

    /* ===== Router: #s/<slug> & #admin ===== */
    function router(){
      const h=(location.hash||'').replace(/^#!?/,'');
      const m=h.match(/^#s\/([^/]+)$/);
      if(m){ renderDetailPage(decodeURIComponent(m[1])); window.scrollTo({top:0,behavior:'smooth'}); return; }
      if(h==='#admin'){ renderAdmin(); window.scrollTo({top:0,behavior:'smooth'}); return; }
      hide(document.getElementById('detailPage')); hide(document.getElementById('adminPage')); show(document.getElementById('home')); show(document.getElementById('about')); show(document.getElementById('register')); show(document.getElementById('list'));
    }
    window.addEventListener('hashchange',router);
    window.addEventListener('load',router);

    /* ===== Login (owner) ===== */
    const loginDlg=document.getElementById('loginDialog');
    document.getElementById('loginBtn').addEventListener('click',()=>loginDlg.showModal());
    document.getElementById('closeLogin').addEventListener('click',()=>loginDlg.close());
    document.getElementById('doLogin').addEventListener('click',()=>{
      const m=(document.getElementById('loginMobile').value||'').trim().slice(-10);
      const p=(document.getElementById('loginPin').value||'').trim();
      const a=load(); const s=a.find(x=>x.mobile===m && x.pin===p);
      if(s){ setSession({id:s.id, at:Date.now()}); document.getElementById('loginMsg').textContent='Logged in âœ…'; loginDlg.close(); toast('Owner mode ON'); renderList();}
      else { document.getElementById('loginMsg').textContent='âŒ Not found. Mobile/PIN check karein.'; }
    });

    /* ===== Basic Analytics (local only) ===== */
    (function(){
      try{
        const KEY='si:analytics:v1';
        const data = JSON.parse(localStorage.getItem(KEY)||'{"visits":0,"last":""}');
        data.visits++; data.last=new Date().toISOString();
        localStorage.setItem(KEY, JSON.stringify(data));
        console.log(`ğŸ‘ï¸ Visits: ${data.visits}, Last visit: ${data.last}`);
      }catch(e){}
    })();

    /* ===== PWA: Service Worker + Install Prompt ===== */
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e)=>{
      e.preventDefault();
      deferredPrompt = e;
      const btn=document.createElement('button');
      btn.textContent='ğŸ“² Install Salon India App';
      btn.className='btn';
      btn.style.position='fixed';
      btn.style.bottom='20px';
      btn.style.right='20px';
      btn.style.zIndex='9999';
      document.body.appendChild(btn);

      btn.addEventListener('click', async()=>{
        btn.style.display='none';
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        deferredPrompt = null;
      });
    });

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
          .then(reg => console.log('âœ… Service Worker registered:', reg.scope))
          .catch(err => console.warn('SW registration failed:', err));
      });
    }
  </script>
</body>
</html>
